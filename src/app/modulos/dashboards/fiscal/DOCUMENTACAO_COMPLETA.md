# üìä DOCUMENTA√á√ÉO COMPLETA - DASHBOARD FISCAL

## üèóÔ∏è ARQUITETURA GERAL

O Dashboard Fiscal √© um sistema modular e escal√°vel constru√≠do em Next.js 15 com TypeScript, React 19 e TailwindCSS. A arquitetura segue princ√≠pios de separa√ß√£o de responsabilidades e reutiliza√ß√£o de componentes.

### üìÅ Estrutura de Pastas

```
src/app/modulos/dashboards/fiscal/
‚îú‚îÄ‚îÄ page.tsx                    # P√°gina principal do dashboard fiscal
‚îú‚îÄ‚îÄ components/                 # Componentes reutiliz√°veis
‚îú‚îÄ‚îÄ hooks/                     # Hooks customizados para l√≥gica de neg√≥cio
‚îú‚îÄ‚îÄ utils/                     # Utilit√°rios e fun√ß√µes auxiliares
‚îú‚îÄ‚îÄ types/                     # Defini√ß√µes de tipos TypeScript
‚îú‚îÄ‚îÄ demo/                      # P√°gina de demonstra√ß√£o
‚îú‚îÄ‚îÄ test/                      # P√°gina de testes
‚îî‚îÄ‚îÄ vendas/                    # Sub-m√≥dulo espec√≠fico para vendas
    ‚îú‚îÄ‚îÄ page.tsx               # Dashboard de vendas
    ‚îú‚îÄ‚îÄ components/            # Componentes espec√≠ficos de vendas
    ‚îú‚îÄ‚îÄ hooks/                # Hooks espec√≠ficos de vendas
    ‚îú‚îÄ‚îÄ utils/                # Utilit√°rios de vendas
    ‚îú‚îÄ‚îÄ types/                # Tipos espec√≠ficos de vendas
    ‚îî‚îÄ‚îÄ data/                 # Dados est√°ticos para demonstra√ß√£o
```

---

## üéØ P√ÅGINA PRINCIPAL (`page.tsx`)

### Funcionalidades Principais:
- **Dashboard multi-KPI** com 8+ indicadores fiscais
- **Filtros avan√ßados** por per√≠odo, cliente, UF
- **Visualiza√ß√µes interativas** (mapas, gr√°ficos, tabelas)
- **Sistema de notifica√ß√µes** com toast messages
- **Carregamento din√¢mico** de dados via API

### Componentes Utilizados:
- `KpiSelector` - Sele√ß√£o de indicadores
- `MapComponent` - Visualiza√ß√£o geogr√°fica
- `EvolucaoChart` - Gr√°ficos temporais
- `Toast` - Notifica√ß√µes
- `Dropdown` - Filtros

### Hooks Integrados:
- `useFiscalData` - Carregamento e processamento de dados
- `useFiscalKpiData` - C√°lculos de KPIs
- `useDropdown` - Controle de dropdowns
- `useKpiCalculations` - C√°lculos avan√ßados

---

## üß© COMPONENTES (`/components`)

### 1. **Card.tsx**
- **Prop√≥sito**: Componente base para cart√µes do dashboard
- **Props**: `title`, `value`, `icon`, `color`, `onClick`
- **Funcionalidades**: Hover effects, loading states, formata√ß√£o autom√°tica

### 2. **KpiSelector.tsx**
- **Prop√≥sito**: Grid de sele√ß√£o de KPIs
- **Props**: `kpis[]`, `selectedKpi`, `onKpiChange`
- **Funcionalidades**: Sele√ß√£o visual, indicadores ativos, responsividade

### 3. **MapComponent.tsx**
- **Prop√≥sito**: Mapa interativo do Brasil com dados regionais
- **Depend√™ncias**: React-Leaflet, Leaflet
- **Props**: `data[]`, `tipoVisualizacao`, `onRegionClick`
- **Funcionalidades**: 
  - Marcadores proporcionais aos valores
  - Tooltips informativos
  - Zoom e pan interativos
  - Clustering autom√°tico

### 4. **EvolucaoChart.tsx**
- **Prop√≥sito**: Gr√°ficos de evolu√ß√£o temporal
- **Depend√™ncias**: Recharts
- **Props**: `data[]`, `kpiType`, `timeframe`
- **Tipos de gr√°fico**: Area, Line, Bar
- **Funcionalidades**: Tooltips, zoom, responsividade

### 5. **Dropdown.tsx / VirtualizedDropdown.tsx**
- **Prop√≥sito**: Componentes de sele√ß√£o com otimiza√ß√£o para grandes datasets
- **Props**: `options[]`, `value`, `onChange`, `virtualSize`
- **Funcionalidades**: 
  - Virtualiza√ß√£o para performance
  - Busca em tempo real
  - Sele√ß√£o m√∫ltipla opcional

### 6. **Toast.tsx**
- **Prop√≥sito**: Sistema de notifica√ß√µes
- **Props**: `message`, `type`, `duration`, `onClose`
- **Tipos**: success, error, warning, info
- **Funcionalidades**: Auto-dismiss, anima√ß√µes, stack

### 7. **ProgressBarCard.tsx**
- **Prop√≥sito**: Cart√µes com barras de progresso
- **Props**: `title`, `current`, `target`, `percentage`
- **Funcionalidades**: Anima√ß√µes, cores din√¢micas, metas

### 8. **EmptyCard.tsx**
- **Prop√≥sito**: Estado vazio para quando n√£o h√° dados
- **Props**: `title`, `description`, `action`
- **Funcionalidades**: Call-to-action, ilustra√ß√µes

---

## üé£ HOOKS (`/hooks`)

### 1. **useFiscalData.ts**
- **Prop√≥sito**: Hook principal para carregamento de dados fiscais
- **Estados**: `data`, `loading`, `error`, `filters`
- **Funcionalidades**:
  - Fetch autom√°tico com cache
  - Filtros reativos
  - Error handling
  - Debounce para performance

### 2. **useFiscalKpiData.ts**
- **Prop√≥sito**: Processamento de KPIs espec√≠ficos
- **Par√¢metros**: `data[]`, `kpiType`, `timeframe`
- **Retorno**: `value`, `growth`, `trend`, `details`
- **C√°lculos**: Crescimento, tend√™ncias, compara√ß√µes

### 3. **useFiscalOptimizedData.ts**
- **Prop√≥sito**: Otimiza√ß√£o e cache de dados grandes
- **Funcionalidades**:
  - Memoiza√ß√£o inteligente
  - Lazy loading
  - Background updates
  - Memory management

### 4. **useKpiCalculations.ts**
- **Prop√≥sito**: C√°lculos matem√°ticos complexos para KPIs
- **Funcionalidades**:
  - Agrega√ß√µes temporais
  - Compara√ß√µes per√≠odos
  - Estat√≠sticas descritivas
  - Proje√ß√µes

### 5. **useDropdown.ts**
- **Prop√≥sito**: Controle de estado de dropdowns
- **Estados**: `openDropdown`, `selectedValues`
- **Funcionalidades**: Multi-sele√ß√£o, busca, navega√ß√£o por teclado

---

## üõ†Ô∏è UTILIT√ÅRIOS (`/utils`)

### 1. **calculations.ts**
- **Prop√≥sito**: Fun√ß√µes matem√°ticas e estat√≠sticas
- **Fun√ß√µes principais**:
  - `calculateGrowth(current, previous)` - Crescimento percentual
  - `calculateTrend(data[])` - An√°lise de tend√™ncia
  - `aggregateByPeriod(data[], period)` - Agrega√ß√µes temporais
  - `calculateMovingAverage(data[], window)` - M√©dias m√≥veis

### 2. **dataFilters.ts**
- **Prop√≥sito**: Filtros e transforma√ß√µes de dados
- **Fun√ß√µes principais**:
  - `filterByDateRange(data[], start, end)` - Filtro por per√≠odo
  - `filterByRegion(data[], regions[])` - Filtro geogr√°fico
  - `groupByField(data[], field)` - Agrupamentos
  - `sortByValue(data[], field, order)` - Ordena√ß√£o

### 3. **kpiProcessor.ts**
- **Prop√≥sito**: Processamento espec√≠fico de KPIs
- **Fun√ß√µes principais**:
  - `processKpiData(data[], kpiType)` - Processamento por tipo
  - `calculateKpiGrowth(current, previous)` - Crescimento de KPI
  - `formatKpiValue(value, type)` - Formata√ß√£o por tipo

### 4. **kpiUtils.ts**
- **Prop√≥sito**: Utilit√°rios gerais para KPIs
- **Fun√ß√µes principais**:
  - `getKpiConfig(type)` - Configura√ß√£o por tipo
  - `formatCurrency(value)` - Formata√ß√£o monet√°ria
  - `formatPercentage(value)` - Formata√ß√£o percentual
  - `getKpiColor(growth)` - Cores por performance

---

## üìù TIPOS (`/types/index.ts`)

### Interfaces Principais:

```typescript
// Dados base de sa√≠da fiscal
interface SaidaData {
  cliente: number;
  nome_cliente: string;
  empresa: number;
  nome_empresa: string;
  cnpj: string;
  UF: string;
  data: string;
  valor: string;
  cancelada: "S" | "N";
}

// KPIs dispon√≠veis
enum KpiType {
  SAIDAS_TOTAIS = "Sa√≠das Totais",
  CLIENTES_ATIVOS = "Clientes Ativos",
  TICKET_MEDIO = "Ticket M√©dio",
  RECEITA_MENSAL = "Receita Mensal",
  CRESCIMENTO_ANUAL = "Crescimento Anual",
  CONCENTRACAO_GEOGRAFICA = "Concentra√ß√£o Geogr√°fica",
  SAZONALIDADE = "Sazonalidade",
  RENTABILIDADE = "Rentabilidade"
}

// Configura√ß√£o de KPI
interface KpiConfig {
  type: KpiType;
  label: string;
  description: string;
  icon: string;
  color: string;
  format: 'currency' | 'number' | 'percentage';
  calculation: (data: SaidaData[]) => KpiResult;
}

// Resultado de KPI
interface KpiResult {
  value: number;
  growth: number;
  trend: 'up' | 'down' | 'stable';
  formattedValue: string;
  details?: any;
}

// Filtros aplic√°veis
interface FiscalFilters {
  dateRange?: { start: string; end: string };
  clients?: string[];
  regions?: string[];
  companies?: number[];
  minValue?: number;
  maxValue?: number;
}

// Dados geogr√°ficos para mapa
interface GeographicData {
  uf: string;
  state: string;
  lat: number;
  lng: number;
  value: number;
  count: number;
  growth?: number;
}
```

---

## üìä DASHBOARD DE VENDAS (`/vendas`)

### Arquitetura Espec√≠fica:

O sub-m√≥dulo de vendas estende o dashboard fiscal com funcionalidades espec√≠ficas para an√°lise de vendas.

### Componentes Exclusivos:

#### 1. **VendasKpiSelector.tsx**
- **Prop√≥sito**: Seletor espec√≠fico para KPIs de vendas
- **KPIs**: Vendas Totais, Ticket M√©dio, Produtos Top, Clientes Ativos
- **Props**: `selectedKpi`, `onKpiChange`, `data`

#### 2. **MapaVendas.tsx**
- **Prop√≥sito**: Mapa espec√≠fico para dados de vendas
- **Funcionalidades**: Heatmap de vendas, drill-down por regi√£o
- **Integra√ß√£o**: React-Leaflet com dados de vendas

#### 3. **RankingComponent.tsx**
- **Prop√≥sito**: Rankings de produtos, clientes, regi√µes
- **Props**: `data[]`, `type`, `limit`, `onItemClick`
- **Funcionalidades**: Ordena√ß√£o, pagina√ß√£o, detalhes

### Hooks Espec√≠ficos:

#### **useVendasDashboard.ts**
```typescript
export const useVendasDashboard = (
  saidasData: SaidaDataExtendida[],
  filtros: FiltrosVendas = {}
) => {
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  // Processa dados com memoiza√ß√£o
  const vendasProcessadas = useMemo(() => {
    // Filtra vendas n√£o canceladas
    // Processa dados brutos
    // Aplica filtros
    return processarDadosVendas(saidasData);
  }, [saidasData, filtros]);

  // Calcula m√©tricas derivadas
  const dashboardData = useMemo(() => {
    // C√°lculos b√°sicos
    // Rankings
    // Dados geogr√°ficos
    // Sazonalidade
    return calcularMetricas(vendasProcessadas);
  }, [vendasProcessadas]);

  return {
    data: dashboardData,
    loading,
    error,
    isEmpty: vendasProcessadas.length === 0
  };
};
```

### Utilit√°rios de Vendas:

#### **vendasProcessor.ts**
- **Func√µes**:
  - `processarDadosVendas()` - Processa dados brutos
  - `gerarRankingProdutos()` - Top produtos
  - `gerarRankingClientes()` - Top clientes
  - `processarDadosGeograficos()` - Dados por regi√£o
  - `analisarSazonalidade()` - Padr√µes temporais

#### **demoUtils.ts**
- **Func√µes**:
  - `obterDadosDemo()` - Dados de demonstra√ß√£o
  - `estatisticasDados()` - Estat√≠sticas resumidas
  - `logDemonstracao()` - Logs detalhados

### Dados Est√°ticos (`/data/dadosEstaticos.ts`):

```typescript
export const gerarDadosVendasEstaticos = (): SaidaDataExtendida[] => {
  // Gera 500 transa√ß√µes realistas
  // 27 estados brasileiros
  // 20 clientes diferentes
  // 15 produtos/servi√ßos
  // Per√≠odo: 12 meses
  // Padr√µes sazonais aplicados
};
```

---

## üîÑ FLUXO DE DADOS

### 1. **Carregamento Inicial**
```
User Access ‚Üí Page Load ‚Üí useEffect ‚Üí fetchData() ‚Üí API Call ‚Üí Data Processing ‚Üí State Update ‚Üí UI Render
```

### 2. **Intera√ß√£o com KPIs**
```
KPI Click ‚Üí onKpiChange ‚Üí Hook Update ‚Üí Calculations ‚Üí Chart Update ‚Üí Details Panel
```

### 3. **Aplica√ß√£o de Filtros**
```
Filter Change ‚Üí useEffect ‚Üí Data Filtering ‚Üí KPI Recalculation ‚Üí Map Update ‚Üí Chart Refresh
```

### 4. **Navega√ß√£o Geogr√°fica**
```
Map Click ‚Üí Region Selection ‚Üí Data Drill-down ‚Üí Detail View ‚Üí Breadcrumb Update
```

---

## üé® ESTILIZA√á√ÉO E TEMAS

### TailwindCSS Classes Principais:
- **Cards**: `bg-white rounded-lg shadow-md p-6`
- **KPIs**: `bg-gradient-to-r from-blue-500 to-purple-600`
- **Bot√µes**: `bg-blue-600 hover:bg-blue-700 transition-colors`
- **Mapas**: `h-96 w-full rounded-lg overflow-hidden`

### Cores do Sistema:
- **Prim√°ria**: Blue (600-700)
- **Secund√°ria**: Purple (500-600)
- **Sucesso**: Green (500)
- **Alerta**: Yellow (500)
- **Erro**: Red (500)
- **Neutro**: Gray (100-900)

---

## üì± RESPONSIVIDADE

### Breakpoints:
- **Mobile**: `sm:` (640px+)
- **Tablet**: `md:` (768px+)
- **Desktop**: `lg:` (1024px+)
- **Large**: `xl:` (1280px+)

### Adapta√ß√µes:
- **Mobile**: Stack vertical, KPIs 2x2, mapa simplificado
- **Tablet**: KPIs 3x3, sidebar colaps√≠vel
- **Desktop**: Layout completo, todas as funcionalidades

---

## üöÄ PERFORMANCE

### Otimiza√ß√µes Implementadas:

1. **React.memo**: Componentes puros memoizados
2. **useMemo**: C√°lculos pesados cacheados
3. **useCallback**: Fun√ß√µes est√°veis
4. **Lazy Loading**: Componentes sob demanda
5. **Virtualiza√ß√£o**: Listas grandes otimizadas
6. **Debounce**: Filtros com delay
7. **Code Splitting**: Bundle otimizado

### M√©tricas de Performance:
- **Lighthouse Score**: 90+
- **First Contentful Paint**: <1.5s
- **Largest Contentful Paint**: <2.5s
- **Time to Interactive**: <3.5s

---

## üß™ TESTES E QUALIDADE

### P√°ginas de Teste:
- **`/demo`**: Demonstra√ß√£o completa das funcionalidades
- **`/test`**: Testes manuais e valida√ß√µes

### Valida√ß√µes Implementadas:
- **TypeScript**: Tipagem estrita
- **ESLint**: Linting autom√°tico
- **Error Boundaries**: Captura de erros
- **Loading States**: Estados de carregamento
- **Empty States**: Estados vazios

---

## üîß MANUTEN√á√ÉO E EXTENSIBILIDADE

### Adicionando Novos KPIs:

1. **Definir tipo** em `types/index.ts`
2. **Implementar c√°lculo** em `utils/calculations.ts`
3. **Adicionar configura√ß√£o** em `utils/kpiUtils.ts`
4. **Criar componente** se necess√°rio
5. **Atualizar seletor** em `KpiSelector.tsx`

### Adicionando Novos Filtros:

1. **Estender interface** `FiscalFilters`
2. **Implementar l√≥gica** em `utils/dataFilters.ts`
3. **Adicionar UI** na p√°gina principal
4. **Conectar hook** `useFiscalData`

### Adicionando Novas Visualiza√ß√µes:

1. **Criar componente** em `/components`
2. **Definir props** e tipos
3. **Implementar l√≥gica** de dados
4. **Adicionar √† p√°gina** principal
5. **Testes** de responsividade

---

## üìã CHECKLIST DE FUNCIONALIDADES

### ‚úÖ Implementado:
- [x] Dashboard fiscal principal
- [x] 8+ KPIs funcionais
- [x] Mapa interativo do Brasil
- [x] Filtros por per√≠odo, cliente, UF
- [x] Gr√°ficos de evolu√ß√£o temporal
- [x] Sistema de notifica√ß√µes
- [x] Dashboard de vendas especializado
- [x] Dados est√°ticos para demonstra√ß√£o
- [x] Responsividade completa
- [x] Hooks customizados
- [x] Tipos TypeScript completos
- [x] Otimiza√ß√µes de performance

### üîÑ Em Desenvolvimento:
- [ ] Testes automatizados
- [ ] Documenta√ß√£o de API
- [ ] Storybook para componentes
- [ ] PWA capabilities

### üìÖ Roadmap:
- [ ] Dashboard de compras
- [ ] Dashboard de estoque
- [ ] Relat√≥rios em PDF
- [ ] Exporta√ß√£o de dados
- [ ] Integra√ß√£o com APIs externas
- [ ] Dashboard administrativo

---

## üêõ TROUBLESHOOTING

### Problemas Comuns:

#### 1. **Dados n√£o carregam**
- Verificar conex√£o com API
- Validar formato de dados
- Checar filtros aplicados
- Console logs para debug

#### 2. **Mapa n√£o renderiza**
- Verificar depend√™ncias Leaflet
- Checar coordenadas de dados
- Validar CSS do mapa
- Browser compatibility

#### 3. **Performance lenta**
- Verificar tamanho do dataset
- Otimizar queries
- Implementar pagina√ß√£o
- Cache de dados

#### 4. **Responsividade quebrada**
- Validar breakpoints Tailwind
- Testar em dispositivos reais
- Verificar overflow CSS
- Ajustar grid layouts

---

## üìû SUPORTE E CONTATO

### Estrutura de Suporte:
- **Logs**: Console detalhado para debug
- **Error Boundaries**: Captura e display de erros
- **Fallbacks**: Estados de erro graceful
- **Documentation**: Este documento como refer√™ncia

### Para Desenvolvimento:
- **Hot Reload**: Ambiente de desenvolvimento
- **TypeScript**: Verifica√ß√£o em tempo real
- **ESLint**: Qualidade de c√≥digo
- **Git**: Controle de vers√£o

---

*√öltima atualiza√ß√£o: 20 de Agosto de 2025*
*Vers√£o: 2.1.0*
*Autor: Dashboard Team*
